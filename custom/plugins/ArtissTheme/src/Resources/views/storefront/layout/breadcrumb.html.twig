{% sw_extends '@Storefront/storefront/layout/breadcrumb.html.twig' %}

{% block layout_breadcrumb_list %}
    {% set breadcrumbKeys = breadcrumbCategories|keys %}

    <ol class="breadcrumb"
        itemscope
        itemtype="https://schema.org/BreadcrumbList">

        {# === HOME === #}
        {% block layout_breadcrumb_list_home %}
            <li class="breadcrumb-item"
                itemprop="itemListElement"
                itemscope
                itemtype="https://schema.org/ListItem">

                <a href="{{ path('frontend.home.page') }}"
                   class="breadcrumb-link"
                   title="{{ context.salesChannel.translated.homeName|default('general.homeLink'|trans) }}"
                   itemprop="item">
                    <span class="breadcrumb-title" itemprop="name">
                        {{ context.salesChannel.translated.homeName|default('general.homeLink'|trans) }}
                    </span>
                </a>

                <meta itemprop="position" content="1">
            </li>
        {% endblock %}

        {# === CATEGORIES === #}
        {% for breadcrumbCategory in breadcrumbCategories %}
            {% set key = breadcrumbCategory.id %}
            {% set name = breadcrumbCategory.translated.name %}
            {% set categoryUrl = breadcrumbCategory.seoUrl %}
            {% set isLast = loop.last %}
            {% set isCurrent = key is same as(categoryId) %}

            {% block layout_breadcrumb_list_item %}
                <li class="breadcrumb-item"
                    {% if isCurrent %}aria-current="page"{% endif %}
                    itemprop="itemListElement"
                    itemscope
                    itemtype="https://schema.org/ListItem">

                    {# --- FOLDER or CURRENT or LAST: NOT A LINK --- #}
                    {% if breadcrumbCategory.type == 'folder' or isLast or isCurrent %}
                        <span class="breadcrumb-link is-active">
                            <span class="breadcrumb-title" itemprop="name">{{ name }}</span>
                        </span>

                        {# --- NORMAL LINK --- #}
                    {% else %}
                        <a href="{{ categoryUrl }}"
                           class="breadcrumb-link"
                           title="{{ name }}"
                           {% if breadcrumbCategory.shouldOpenInNewTab %}target="_blank"{% endif %}
                           itemprop="item">
                            <span class="breadcrumb-title" itemprop="name">{{ name }}</span>
                        </a>
                    {% endif %}

                    <meta itemprop="position" content="{{ loop.index + 1 }}">
                </li>
            {% endblock %}

            {# === SEPARATOR (Shopware < 6.8) === #}
            {% if not feature('v6.8.0.0') %}
                {% block layout_breadcrumb_placeholder %}
                    {% if key != breadcrumbKeys|last %}
                        <div class="breadcrumb-placeholder" aria-hidden="true">
                            {% sw_icon 'arrow-medium-right' style { size: 'fluid', pack: 'solid' } %}
                        </div>
                    {% endif %}
                {% endblock %}
            {% endif %}

        {% endfor %}
    </ol>
{% endblock %}