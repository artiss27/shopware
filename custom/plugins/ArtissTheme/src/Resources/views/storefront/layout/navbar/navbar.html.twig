{#vendor/shopware/storefront/Resources/views/storefront/layout/navbar/navbar.html.twig#}

{% sw_extends '@Storefront/storefront/layout/navbar/navbar.html.twig' %}

{% block layout_navbar_menu_items %}
    {% for treeItem in header.navigation.tree %}
        {% set category = treeItem.category %}
        {% set id = category.id %}
        {% set name = category.translated.name %}
        {% set hasChildren = treeItem.children|length > 0 %}

        {# Find children of the main category and show them in navbar #}
        {% if mainCategoryId is defined and id == mainCategoryId %}
            {% set itemsToShow = treeItem.children %}
        {% else %}
            {% set itemsToShow = [] %}
        {% endif %}

        {% for childItem in itemsToShow %}
            {% set childCategory = childItem.category %}
            {% set childId = childCategory.id %}
            {% set childName = childCategory.translated.name %}
            {% set childHasChildren = childItem.children|length > 0 %}

            {% block layout_navbar_menu_item %}
                <li class="nav-item nav-item-{{ childId }} dropdown position-static">
                    {% block layout_navbar_menu_item_link %}
                        <a class="nav-link nav-item-{{ childId }}-link root main-navigation-link p-2 {% if childHasChildren %}dropdown-toggle{% else %}no-dropdown{% endif %}"
                           href="{{ childCategory.seoUrl ?: '#' }}"
                           {% if childHasChildren %}data-bs-toggle="dropdown"{% endif %}
                           {% if childCategory.type != 'folder' and childCategory.shouldOpenInNewTab %}target="_blank"{% endif %}
                           itemprop="url"
                           title="{{ childName }}"
                        >
                            {% block layout_navbar_menu_item_link_content %}
                                <span itemprop="name" class="main-navigation-link-text">{{ childName }}</span>
                            {% endblock %}
                        </a>
                    {% endblock %}

                    {% if childHasChildren %}
                        {% block layout_navbar_menu_item_children %}
                            <div class="dropdown-menu w-100 p-4">
                                {% sw_include '@Storefront/storefront/layout/navbar/content.html.twig' with {
                                    themeIconConfig: themeIconConfig,
                                    navigationTree: childItem,
                                    level: level+1,
                                    page: page
                                } only %}
                            </div>
                        {% endblock %}
                    {% endif %}
                </li>
            {% endblock %}
        {% endfor %}
    {% endfor %}
{% endblock %}